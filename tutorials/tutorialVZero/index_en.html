<html>
<head>
<title>
Tutorial: How to use Visual Zero VM
</title>
</head>

<body>

<P>
<hr>
<TABLE WIDTH=100%>
<TR>
      <TD>
            <h1>Tutorial: How to use Visual Zero VM</h1>
      </TD>
	  <TD>
			<a href="index.html">
            <IMG HEIGHT=25 WIDTH=50 ALIGN=CENTER SRC="bandera_espanola.jpg" ALT="en español">
			</a>
	  </TD>
	  <TD>
			<a href="index.html">Lea este documento en español</a>
	  </TD>
      <TD>
            <IMG ALIGN=RIGHT SRC="tiraZero.jpg" ALT="Zero (the plane fighter)">
      </TD>
</TR>
</TABLE>
<hr>
<P>



<P>
Visual Zero VM is the same virtual machine present in the command line tool <b>zvm</b> (Zero Virtual Machine), but adding a graphic user interface, which allows better interaction on the user's part, by means of the simple use of the structural reflection capabilities of Zero.
<P>
First of all, you should unzip the Zero bin package in a given directory, no matter which one (from now on, the Zero's directory), provided this has not been done before. Also, the standard library should be compiled. In order to do that, you should just open a console in the Zero's directory and type:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
za IntStdLib
</CODE>
</td>
</tr>
</table>
<p>
You can also try to drag and drop <code>IntStdLib</code> over the <code>za</code> executable. In some systems, it is needed to give execution permissions to some files:

<table align=center bgcolor="#FFFF99">
<tr>
<td>
<code>
chmod +x za
<br>chmod +x zm
<br>chmod +x zd
<br>chmod +x zvm
</code>
</td>
</tr>
</table>
<P>
Now you can try to compile the standard library again if the previous step didn't work.
<p>The standard library must be compiled before using Zero: however, once it has
been compiled this step won't be needed to be taken anymore.
<P>
The Visual Zero VM program is <code>vzero.exe</code> in Windows systems, which can be executed from command line by typing:

<p>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
vzero
</CODE>
</td>
</tr>
</table>
<p>

or by double-clicking the file in an explorer window showing the Zero's directory.
<h2>Beginning: basic concepts</h2>
Once started, Visual Zero VM shows the container explorer. Containers are similar to directories (or folders) or files, but storing objects instead of arhives. The container where all executions are carried out is the so called <b>Exe</b>, hanging directly form the <b>Root</b> container. In order to build a path through containers, the '.' must be used between two containers, as when an attribute is accessed through an object (Actually, containers are objects). The only exception to remember is that the root container doesn't have a name. For example, the path to get to the Exe container is <code>.Exe</code>.

<P align=center>
<img src="vzero_intro.png" alt="intro to VZero VM">
</p>
<P>
<P>
All possible values which one deal with inside the VM (Virtual Machine) are objects. In contrast to other VM's, there are not primitive values; primitive values are represented by objects as well. In the Zero VM, integer numbers, floating-point numbers, strings and vectors can be managed, again, represented by average objects.
<p>
In the picture above, some functionality of the main application window can be seen: the open folder allows the user to load containers in the system. The glass opens an object explorer, allowing you to explore the objects in the Exe container, initially.
<p>
The button in the lower left corner, labeled as <i>Contenedor padre</i> (parent  container) makes possible to go upwards in the container's hierarchical relation graph. For example, from the Exe container the Root container would be shown by pressing this button.
<p>
The button labeled as <i>nuevo</i> (new) creates an object of the type shown by the combo box at its left. The possible types are: object (regular objects), integer, float, and vector.

<P>
<h3>Object creation</h3>
<P>
Under the container explorer there is a selection box and a button labeled as <i>Nuevo</i> (new). The list lets you choose among various different objects. This way, <i>objeto</i> lets you create a new average object; <i>entero</i> (integer) lets you create an integer number (a shortcut of sending the message <code>copy</code> to the object <b>LiteralInt</b>); <i>flotante</i> (float) lets you create a floating-point number; <i>Cadena</i> (string) lets you create a character string; <i>Vector</i> lets you create a vector of objects.

Once the button <i>nuevo</i> is pressed, a dialog box is shown asking for some data. The name of the object in case of a regular one, or for example the numeric value to be represented by the object in case of choosing an integer or a float, or a text in case of a character string.
<P>
In case of choosing a vector to be created, the value to enter is a little bit more special.
<P>
<h4>Entering vector values</h4>
<P>
When <i>vector</i> is selected, and once <i>nuevo</i> is pressed, a dialog box asking for the contents of the new vector will be shown. The simplest vector is the empty one (o elements), which can be specified by typing the following:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
{}
</CODE>
</td>
</tr>
</table>
<P>
However, a vector of one element is specified with:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
{ 1 }
</CODE>
</td>
</tr>
</table>
<P>
making a vector of 1 elements (its size is 1) with an <b>Int</b> object of value 1. The index of this first value is 0.
<P>
When introducing various elements, they are separated by commas.
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
{ 1, 2, 3 }
</CODE>
</td>
</tr>
</table>
<P>
The user must take into account that vectors can contain references to any object, it is not necessary to have all elements of the vector deriving of a given object. For example:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
{ 1, "hello", 2.0 }
</CODE>
</td>
</tr>
</table>
<P>
It is even possible to include other vectors:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
{ 1, { 3, 4 }, 2.0 }
</CODE>
</td>
</tr>
</table>
<P>
<h3>Erasing objects</h3>
<P>
Press the left button of the mouse over an object shown in the container explorer. Then press the right buton and choose <i>eliminar</i> (erase) from the list. Please note that this does only erase the object from the container ... if it is being referenced by other objects, it will remain in memory.
<P>
<h2>An exercise: persons and employees</h2>
<P>
Start the program and press <i>nuevo</i>, having <i>objeto</i> chosen in the list under the container explorer.
<P align=center>
<img src="vzero_creartraitspersona.png" alt="creating TraitsPersona">
</p>
<P>
You will be asked for the name of the object. Please enter <i>TraitsPersona</i> (TraitsPerson). Then an object explorer will open, showing the properties of the new <b>TraitsPersona</b> object. The explorer is divided in three sections, up to down: attributes, inherited methods and methods.
<P align=center>
<img src="vzero_traitspersonacreado.png" alt="TraitsPersona created">
</p>
Look for <code>addAttribute</code> in the inherited methods section. Press the left button of the mouse over it, and then press the right button and choose <i>ejecutar</i> from the list.
<P align=center>
<img src="vzero_exeaddattribute.png" alt="executing addAttribute">
</p>
A new dialog box will appear asking for the arguments the method will be invoked. In this case, we must provide the name of the attribute, and the object it will point to. The name of this new attribute is <i>"nombre"</i> (name), storing the name of the person. So this is the value for the first box, but in this case you have to enter it with double quotes, as it must be interpreted as a new <b>String</b> object. The contents of the attribute to be created is also a string, so for example <i>"Juan Nadie"</i> ("John Doe") will be an appropriate value.
This way, the new objects will be created before invoking the method <code>addAttribute</code> with them. The last step is to press <i>Aceptar</i>, in order for the VM to execute the given method.
<P align=center>
<img src="vzero_addattributeargs.png" alt="entering arguments for addAttribute">
</p>
When a method is executed, the standard output is opened, as well as an object explorer with the properties of the object produced by the execution. In this case, they are not relevant, so both windows can be closed, going back to the
<b>TraitsPersona</b> object explorer. The new attribute will appear in the list of attributes of the object, the one that appears at the top of the explorer. It is possible to doble-clic it (i.e., press the left button of the mouse quickly two times over it), in order to see the object it is pointing to.
<P>
The same steps taken for adding the <i>nombre</i> (name) attribute to the <b>TraitsPersona</b> object, can be taken in order to create the attribute <i>"email"</i> with its corresponding value (object) <i>"Juan@nadie.com"</i> ("john@doe.com"). Remember to use the doble-quote to express string objects.

<P>
A <code>toString</code> method for <b>TraitsPersona</b> would be really useful. This method exits in <b>Object</b>, the root of the inheritance hierarchy, returning the name of the object (or its value, provided it is an int, float, string, or even vector -a string with the result of executing the <code>toString</code> of each element-). For persons, it would be useful to return the most relevant information in a <b>String</b>.
<P>
So we need to create a method <code>toString</code> for <b>TraitsPersona</b>. This method will be tipically called when trying to print an object in standard output. In the Visual Zero VM, it is also a good way to obtain a summary of the data stored in the object.
<P>
Look for the method <code>addMethod</code> and select, by right-clicking it, the option <i>ejecutar</i> (execute) from the context menu. A dialog box similar to the one that was presented for the attributes will appear. This time, the name of the method, and a vector with the names of the attributes must be provided. The name of the method is <i>"toString"</i> (including the double quotes), and an emtpy vector <i>{}</i> must be entered for its arguments (the <code>toString</code> method doesn't need any).

<P align=center>
<img src="vzero_addmethodargs.png" alt="entering arguments for addMethod (toString)">
</p>
<P>
Once created (pressing the <i>Aceptar</i> button), the new method will appear in the methods section of the object explorer, the one at the middle of the window. We must enter its source code, so we enter the following Zero assembler (after double-clicking it):

<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<code>
SET nombre
<br>ASG __rr
<br>
<br>STR ": "
<br>MSG __rr concat __acc
<br>ASG __rr
<br>
<br>SET email
<br>MSG __rr concat __acc
<br>ASG __rr
<br>RET
</code>
</td>
</tr>
</table>
<P>
This assembler code just assigns the object pointed by the <i>nombre</i> (name) attribute to the return reference register (<code>__rr</code>), and then concatenates the string literal ": ", followed by the string pointed by the attribute <i>e.mail</i>.
<P align=center>
<img src="vzero_creandotostring.png" alt="entering the toString body">
</p>
Once it has been typed, the <i>compilar</i> button should be pressed, and almost immediately he message <i>compilación realizada con éxito</i> (compilation succesful) should appear on the screen.
<P>
The new method can be executed the same way any other one has been executed: the option <i>execute</i> of the context menu, once the method is right-clicked. Try it now, and you will obtain athe result as an object explorer of a <b>String</b> object containing:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
Juan Nadie: juan@nadie.com
</code>
</td>
</tr>
</table>
<P>
<P align=center>
<img src="vzero_resultadotostring.png" alt="result of executing toString">
</p>
... which you should discard (by closing its explorer). Now the new method has been verified.
<P>
It could be interesting to create a new pair of methods: <code>setNombre</code> (<i>setName</i>), with arguments <code>{ "n" }</code>, and <code>setEmail</code>, with arguments <code>{ "e" }</code>. Once created, introduce the following assembly code for each one:

<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
method + setNombre( n )
<P>
SET n
<br>ASG nombre
<br>RET
</code>
</td>
<td>
<code>
method + setEmail( e )
<p>
SET e
<br>ASG email
<br>RET
</code>
</td>
</tr>
</table>
<P>
<P align=center>
<img src="vzero_creandosetnombre.png" alt="argumentos para setNombre">
</p>
<P>
This assembly code just assigns the objects passed as argument to the <i>nombre</i> and <i>email</i> attributes. We are assuming here that the objects received in these functions are strings containing the right information. At least, we could check whether the objects received are strings by placing the following instructions in-between the ASG and SET assembly instructions, in both methods:

<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
IOF String
<br>JOT assign
<br>TRW ETypeMismatch
<br>ETQ assign
</CODE>
</td>
</tr>
</table>
<P>

<P>
With this new code, in case of receiving an object of the wrong "type", an exception is thrown. Please note that this exception throwing is not mandatory.

<P>
Now, using the controls below the container explorer of the main window, create a new object, called <b>Persona</b>.
<P align=center>
<img src="vzero_crearpersona.png" alt="creando Persona">
</p>
Once created, please double-click it in order to make an object explorer to appear for it.

<P align=center>
<img src="vzero_personacreado.png" alt="Persona creado">
</p>
Select the <i>parent</i> attribute, and clicking it with the right button of the mouse, choose <code>cambiar</code> (<i>change</i>) from the contextual menu.
<P align=center>
<img src="vzero_cambiarparentpersona.png" alt="cambiar parent de Persona">
</p>
Of the scrollable list in the assign object dialog, choose <b>TraitsPersona</b>, (<i>TraitsPerson</i>). Wiht this action, the prototype to be used in order to create new <b>Persona</b> (<i>Person</i>) objects has been created.

<P align=center>
<img src="vzero_cambiarparentpersonaargs.png" alt="argumentos para cambiar parent de Persona">
</p>
<P>
In order to create new person objects, just select the <code>copy</code> method of the inherited methods list for the object <b>Persona</b>. It will be needed to give the name of the new object, in double quotes. For an example of Person with one of the developers of Zero, the name could be <b>personaBaltasar</b> (<i>baltasarPerson</i>). Once created, the object will appear in an object explorer. It is not linked to any container, so it is going to be lost of the explorer is changed. You can make it part of the container, so this object will be more permanent. In order to achieve this, just press the button "Save in exe" on the top of the object explorer. It will appear in the container explorer.

<P>
Please note that it is possibe to avoid separating <b>Persona</b> and <b>TraitsPersona</b>, having only one object, say <b>Persona</b>. Each time an object was created, all methods and attributes would be copied at the same time, which would make the copy very expensive. With this separation, the methods exist in only one object (more or less similar to a class), while the state would be copied only each time a new object were created. 

<P>The object <b>personaBaltasar</b> has been created, though its attributes have not been set properly. In order to achieve this, both methods <code>setEmail</code> and <code>setNombre</code> should be called with the appropriate data, which is "jbgarcia@nospampofavo.uvigo.es" (<i>"jbgarcia@nospamplease.uvigo.es"</i>) and "Baltasar", respectively.
<P>
It should be noted that attributes <i>nombre</i> and <i>email</i> are now part of the object <b>personaBaltasar</b>. This happens because while not modified they share the very same attributes with <b>TraitsPersona</b>, but as soon as they are modified a new instance of these attributes is created in the object. This technique is called "copy-on-write", which means that the duplication is done only when necessary.

<P>
Executing the method <code>toString</code> of <b>personaBaltasar</b>, the following is obtained:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
Baltasar: jbgarcia@nospampofavo.uvigo.es
</code>
</td>
</tr>
</table>
<P>
<P align=center>
<img src="vzero_personaBaltasar.png" alt="argumentos para cambiar parent de Persona">
</p>
We could carry out now an exercise about inheritance. Please create a new object called <b>TraitsEmpleado</b> (<i>TraitsEmployee</i>), using the <code>createChild</code> method of the object <b>TraitsPersona</b>. This will create an empty object with its <i>parent</i> attribute pointing to <b>TraitsPersona</b>.
<P>
Create now the <i>salario</i> (<i>salary</i>) attribute, as described above (i.e., executing the method <code>addAttribute</code>), with value 0. This means that you have to give the name of the attribute, being "salario" (with double quotes), and 0 (without double quotes) as second argument.
<P>Create the method <code>setSalario</code> (<i>setSalary</i>) by means of <code>addMethod</code>. Please give { "s" } as the vector of arguments for this method. Method's body should be completed as follows:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
SET s
<br>ASG salario
<br>RET
</code>
</td>
</tr>
</table>
<P>
Now, we can already create a new method <code>toString</code> for <b>TraitsEmpleado</b>:
<P>
<table align=center bgcolor="#FFFF99">
<tr>
<td>
<CODE>
MSG __this ^toString
<br>ASG __rr
<br>
<br>STR ", earns "
<br>MSG __rr concat __acc
<br>ASG __rr
<br>
<br>MSG salario toString
<br>MSG __rr concat __acc
<br>ASG __rr
<br>RET
</code>
</td>
</tr>
</table>
<P>
Through the first message to <code>__this</code> (a register that stores a reference to the object which is executing the method), with <code>^toString</code>, it is assured that the method of <b>TraitsPersona</b> will be called. If it were not done this way, a recursive call would be performed and would become and infinite loop.
<P>
Once we have the description of the info related to <b>Persona</b>, the salary must be concatenated, inserting the String ", earns" in-between.
<P>
A prototype object for employees must be created, now the traits object is ready. This can be done by simply creating a new object and changing its parent to point to <b>TraitsEmpleado</b> (<i>TraitsEmployee</i>), as explained previously. The same result can be achieved by invoking the method <code>createChild</code> on <b>TraitsEmpleado</b>.
<P>
It is now possible to experiment with dynamic inheritance. Open an object explorer for <b>personaBaltasar</b> and change its <i>parent</i> atttribute to point to <b>TraitsEmpleado</b>, instead of <b>TraitsPersona</b>. The information we had in our recently <b>Persona</b> <i>instance</i> is kept, but now can call also methods in <b>TraitsEmpleado</b>. For example, if <code>setSalario</code> is now executed, giving any amount, we will see through <code>toString</code> how this new information has been added to the object.
<P>
This change can be of course reverted, by simply changing again the <i>parent</i> attribute of personaBaltasar back to <b>TraitsPersona</b>. The salary information will still be there, though it won't be used for anything. This cna be checkde out by invoking its <code>toString</code> method.

<P>
A diagram showing the objects involved in this tutorial can be found below. The dotted line signals the parental relation changed from <b>TraitsPersona</b> to <b>TraitsEmpleado</b>.
<P>
<img src="personaEmpleado.png" alt="diagrama de objetos">
<P>
<hr>
<i>Tutorial: How to use Visual Zero
<br>(c) 2005</i>

</body>
</html>
