<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=iso-8859-1">
  <title>Persistence Tutorial</title>


  <meta name="GENERATOR" content="OpenOffice.org 1.9.129 (Linux)">

  <meta name="CREATED" content="20060125;20052300">

  <meta name="CHANGED" content="20060315;20422700">

  <style>
<!--
@page { size: 21cm 29.7cm; margin: 2cm }
P { text-indent: 0.64cm; margin-bottom: 0cm; text-align: justify }
H2 { margin-bottom: 0.21cm }
H2.western { font-family: "Bitstream Vera Sans", sans-serif; font-size: 12pt; font-style: oblique }
H2.cjk { font-family: "Mincho"; font-size: 14pt; font-style: italic }
H2.ctl { font-family: "Tahoma", "Lucidasans", "Lucida Sans", "Arial Unicode MS"; font-size: 14pt; font-style: italic }
-->
  </style>
</head>


<body>

<h1>Persistence Tutorial using Visual Zero</h1>

<p>
</p>

<p style="text-indent: 0cm; text-decoration: none; font-weight: bold;" align="left"><big><big><font size="2"><big><big>Index</big></big></font></big></big></p>

<ul>

  <li><font size="2"><a href="#intro">Introduction</a></font></li>

  <li><a href="#traits"><font size="2">The
common traits of persons</font></a></li>

  <li><a href="#proto"><font size="2">The
person prototype and the first instance</font></a></li>

  <li><a href="#addressbook"><font size="2">The
address book</font></a></li>

  <li><a href="#persistence"><font size="2">Making
objects persist</font></a></li>

</ul>

<h2><a name="intro"></a>Introduction</h2>

<p style="text-indent: 0cm; text-decoration: none;" align="left"><font size="2">An
example, a simple address book, will be discussed through this
section in order to show the interactive capabilities of this visual
environment, as presented previously. Follows an image of the environment running a simple HelloWorld object.</font></p>

<p align="center"><img style="width: 665px; height: 497px;" alt="The VZero environment" src="vzero_fig1.jpg" align="middle"></p>

<a name="traits">
<h2 class="western">The common traits of persons</h2>

</a>
<p style="text-indent: 0cm;" align="left"><span style="text-decoration: none;"><font size="2">Firstly,
a new object will be created to deal with personal information in the
address book. Once the environment is started, it is possible to
press <i>new</i>, having <i>object</i> chosen
in the list under the
container explorer, in order to create this object. The environment
will trigger the execution of the </font><font style="font-size: 9pt;" size="2"><font face="Courier 10 Pitch">createChild()</font></font><font size="2">
method of the <b>Object</b> object, asking for its
parameters.
Actually, the only parameter needed is the object's name, so the
environment is thus asking </font></span><font size="2">for
the name
of the object. By entering &ldquo;<span style="font-style: normal;">TraitsPerson</span><i>&rdquo;
</i><span style="font-style: normal;">(including
quotes)</span>, the
object representing all persons will be created. An object inspector
will open, showing the properties of the new <b>TraitsPerson</b>
object. The explorer is, as discussed before, divided in three
sections, up to down: attributes, own methods and inherited methods.<span style="text-decoration: none;">
Although the object has been created successfully, it has no
information to hold or behaviour to offer. It is possible to solve
this by selecting the <i>add attribute</i> contextual menu
option or by choosing
</span></font><code><font style="font-size: 9pt;" size="2">addAttribute</font></code><font size="2">
in the inherited methods section, pressing the right button of the
mouse and selecting <i>execute</i><span style="font-style: normal;">.</span>

<p align="center">
<img src="vzero_fig4.jpg" alt="Adding an attribute" align="middle">
</p>

A new dialogue box wi</font><font size="2">ll
appear asking for the arguments
the method will be invoked with. In this case, the name of the
attribute must be provided, as well as the object it will point to.
The name of this new attribute is <span style="font-style: normal;">&ldquo;name&rdquo;</span>,
which will be used in order to store the name of the person. So this
is the value for the first box, always remembering that it is needed
to enter it with double quotes, as it must be interpreted as a new
<b>String</b> object. The contents of the attribute to be
created is
also a string, so for example <i>"</i><span style="font-style: normal;">John
Doe</span><i>"</i> can be an appropriate value. The
environment
automatically creates special values such as strings (enclosed in
quotes), numbers (as themselves), and vectors (enclosed in braces),
before invoking the method </font><code><font style="font-size: 9pt;" size="2">addAttribute</font></code><font size="2">
with them. The last step is to press <i>Accept</i>, in
order for the
VM to execute the given method.</font></p>

<p align="center">
<img src="vzero_fig5.jpg" alt="Adding an attribute" align="middle">
</p>

<p style="text-indent: 0cm;" align="left"><font size="2">&nbsp;When a method is
executed, an object inspector with the properties of the object
returned by the execution is displayed. In this case, it is not
relevant, so its window can be closed, going back to the <b>TraitsPerson</b>
object inspector. The new attribute appears now among the attributes
of the object, the one that appears at the top of the explorer. It is
possible to double-click it in order to see the object it is pointing
to, a simple new <b>String</b> object. </font>
</p>

<p style="text-indent: 0cm;"><font size="2">
The same steps taken for
adding the <i>name</i> attribute to the <b>TraitsPerson</b>
object,
can be taken in order to create the attribute <i>email</i>,
using
this time the values <i>"</i><span style="font-style: normal;">email</span><i>"</i>
and <span style="font-style: normal;">"</span>John@doe.com<span style="font-style: normal;">"
as arguments</span>. Again, the use double-quotes is needed here.
</font></p>

<p style="text-indent: 0cm;" align="left"><font size="2"> It would be
useful to be able to change the name and the e.mail of the person.
That behaviour must be accomplished by a method. In order to add a
method to a given object, the contextual menu option add can be used,
as well as executing directly the </font><code><font size="2">addMethod
</font></code><font size="2">method inherited
from <b>Object</b>.

<p align="center">
<img alt="Executing setData" src="vzero_fig7.jpg" align="middle">
</p>


 A dialogue box similar to the one that
was presented for the attributes will appear. This time, the name of
the method, and a vector with the names of the attributes must be
provided. The name of the method is &ldquo;<span style="font-style: normal;">setData&rdquo;</span>
(including the double quotes), and a vector </font><span style="font-style: normal;"><font style="font-size: 9pt;" size="2"><font face="Courier 10 Pitch">{&ldquo;aName&rdquo;,
&ldquo;anEmail&rdquo;}</font></font><font size="2"> </font></span><font size="2">must
be entered for its arguments. Once created (pressing the <i>Ok</i>
button), the new method will appear in the methods section of the
object inspector, the one in the middle of the window. Its source
code must be entered, which corresponds with the following Zero
assembler (instructions can be entered by double-clicking the the new
method): </font><code><font size="2">SET
aName, ASG name, SET anEmail,
ASG anEmail<font size="2" face="Nimbus Roman No9 L">, changing each
comma by a
</font></font><code><font size="2"><font face="Nimbus Roman No9 L">carriage
return.</font></font></code><font size="2"> <br>



<p align="center">
<img alt="Executing setData" src="vzero_fig8.jpg" align="middle">
</p>






</font></code><font size="2">This
assembler code just assigns the object pointed by arguments and make
the attributes point to them. If the <i>Compile</i> button
is
pressed, then that instructions will become the new body of the
<i>setInfo</i> method. Once returned to the <i>object
inspector </i>for
<b>TraitsPerson</b>, it can be executed as any other method
in order
to verify its behaviour.</font></p>

<h2 class="western"><a name="proto"></a>The
Person prototype and a first
instance</h2>

<p style="text-indent: 0cm;"><font size="2">
Now, using the controls
below the container explorer of the main window, a new object, called
<b>Person</b>, must be created in order to be able to
create new
persons by means of a copy operation. This new and empty object will
appear described by an object inspector if it is double-clicked in
the container explorer. In order to make it derive from <b>TraitsPerson</b>,
the <i>parent</i> attribute must be selected, and clicking
it with
the right button of the mouse, the <i>change</i> option
chosen from
the contextual menu.

<p align="center">
<img src="vzero_fig6.jpg" alt="Changing the parent attribute" src="vzero_fig2.jpg" align="middle">
</p>

 Of the scrollable list in the assign object
dialog, the <b>TraitsPerson</b> should be chosen. In order to create new <b>Person</b>
objects, it
is just needed to press the <code><font size="2">copy</font></code><font size="2">
button of the object inspector. After providing the name of the
object, an exact copy of </font><b>Person</b> will
be created (which
is actually empty: the important concept right now is that it
inherits from <b>TraitsPerson</b>). For an example of <b>Person</b>
with one of the developers of Zero, the new name could be <b>baltasar</b>.</font></p>

<p style="text-indent: 0cm;"><font size="2">
Once created, the object
will appear in an object inspector. It is not linked to any
container, so it will be lost as soon as the inspector is closed.
Therefore it must be saved (using the appropriate button in the
inspector) to be stored in the current container. As expected, the
button <i>Save</i> on the top of the object inspector must
be
pressed. The object's name will now appear in the container
explorer. Note that, as it happens in this example, the current
container is <b>Exe</b>, the object will be lost when the
VM finishes
its execution.</font></p>

<p style="text-indent: 0cm;"><font size="2">
Please take into account
that it is possible to avoid separating <b>Person</b> and
<b>TraitsPerson</b>, having only one object, namely <b>Persona</b>.
But each time an object was created, all methods and attributes would
be copied at the same time, which would make the copy very expensive.
With this separation, methods exist only in one, shared, object (more
or less similar to a class), while the state would be copied only
each time a new object was created [15].</font></p>

<p style="text-indent: 0cm;"><font size="2">
The object <b>baltasar</b>
has been created, though its attributes have not been set properly.
In order to achieve this, the <i>setData</i> method should
be called
with the appropriate arguments, which are
&ldquo;Baltasar&rdquo; and
&ldquo;jbgarcia@pleasenospam.uvigo.es<i>" , </i>respectively.
</font></p>

<p style="text-indent: 0cm;"><font size="2">
It should be noted that
attributes <i>name</i> and <i>email</i> are
now part of the object
<b>baltasar</b>. This happens because while not modified
they share
the very same attributes with <b>TraitsPerson</b>, but as
soon as
they are modified a new instance of these attributes is created in
the object. This technique is called <i>copy-on-write</i>,
which
means that the duplication is done only when necessary. </font>
</p>

<h2 class="western"><a name="addressbook"></a>The
address book</h2>

<p style="text-indent: 0cm;"><font size="2">
Now it is needed to
introduce this <b>Person</b> instances in a data
structure, allowing
some kind of searching. The natural key would be the name of person,
which makes a map (an association between strings and objects) the
ideal structure. The standard library has a map, so it is possible to
create the new data structure just by inheriting from the <b>Map</b>
object in the <b>IntStdLib</b> container. In order to
achieve this, a
new object must be created (for example, <i>addressbook</i>)
and its
parent attribute must be changed (as explained above) to point to
<b>Map, </b><span style="">just by
introducing its reference: <i>Map</i></span>
(library objects are always reachable).
The map already provides an <font style="font-size: 9pt;" size="2"><font face="Courier 10 Pitch">add()</font></font>
method that takes a string and an object as arguments. 

<p align="center">
<img src="vzero_fig2.jpg" alt="The addressbook object" src="vzero_fig2.jpg" align="middle">
</p>

A more
convenient <font style="font-size: 9pt;" size="2"><font face="Courier 10 Pitch">add()</font></font>
method, automatically taking the name of the <b>Person</b>
object as
index for the map would be really useful. Thus, a new method, called
&ldquo;add&rdquo;, taking only an object as parameter (<font style="font-size: 9pt;" size="2"><font face="Courier 10 Pitch">{
&ldquo;aPerson&rdquo; }</font></font>), must be
created in <b>addressbook</b>,
with a new body presenting the functionality pursued <span style=""><span style="font-style: normal;"></span></span>: <font style="font-size: 9pt;" size="2"><font face="Courier 10 Pitch">SET
aPerson.name, MSG __this ^add __acc aPerson, RET __acc</font></font>.
This method just takes the name of the object passed as argument and
calls the add method in the parent object (that is the meaning of
'^') with this name and the object itself. In order to store the
object <b>b<span style="font-style: normal;">altasar</span></b>
in the
address book, the recently created method of this object must be
executed, selecting <b>baltasar</b> from the drop-down
list.</font></p>

<h2 class="western"><a name="persistence"></a>Making
objects persistent</h2>

<p style="text-indent: 0cm;"><font size="2">
Although the main objects
of the application have been created, they are stored in the <b>Exe</b>
container. This container is always transient, which means that if we
end the execution of the VM all the <b>Person</b> objects,
the
address book, etc., will be lost. In order to preserve these objects,
they must be included in a persistent container. There are already
some persistent containers available in the Zero persistent
programming system. The root (<i>psRoot</i>), and the
standard
library container (<i>psRoot.IntStdLib</i>). None of these
are
appropriate for the needs of the exercise: the standard library
should be only used to store objects like <b>Map</b>, <b>String</b>
or <b>Object</b>, while storing objects of user
applications in the
root container is allowed but not correct: that behaviour would
convert the persistent store in a mess of objects. The correct
solution is to create a new container. In order to get to the root
container, the <i>parent container</i> button must be
pressed until
the root container is reached (i.e., it is not possible to go up in
the hierarchy any more, one click away from <b>Exe</b>).
Then,
&ldquo;container&rdquo; must be selected in the pull-down box
and press new.
A new container will be created under the root one, after entering
its corresponding name which could be &ldquo;<span style="">Addressbook</span><b>&rdquo;</b>.
</font>
</p>

<p style="text-indent: 0cm;"><font size="2">
Once the container has been
created, the recently created objects should be stored inside it. In
order to achieve this: the <b>Addressbook</b> container
must be
entered with a double-click in the container explorer and, again in
the contextual menu of the container explorer, <i>add objects </i><span style="font-style: normal;">should
be chosen</span>. That will trigger the execution of the <font style="font-size: 9pt;" size="2"><font face="Courier 10 Pitch">add()</font></font>
method of the container object. In the dialogue window, select
<b>addressbook</b> from the pull-down menu. The <b>addressbook</b>
object will appear now as part of the <b>Addresbook</b>
container.</font></p>

<p style="text-indent: 0cm;"><font size="2">
Inserting the <b>addressbook</b>
object is enough to have all remaining objects (<b>TraitsPerson</b>
and <b>baltasarPerson</b>) inserted as well, just because
of the
relations among them. The <b>addressbook</b> object stores
a
reference to <b>baltasarPerson</b>, while <b>baltasarPerson</b>
stores a reference (through the <i>parent</i> attribute)
to the
<b>TraitsPerson</b> object. The VM will follow all these
references
to determine which objects must be made persistent as well inside the
container (this means that the effect will not be seen until the
environment is closed and reopened, though the objects can always be
inserted manually). On the other hand, <b>Person</b>, the
prototype
object created as a factory of new persons, will have to be copied
explicitly (although this is not mandatory for this example).</font></p>

<p style="text-indent: 0cm;"><font size="2">
If the environment is shut
down now, these persistent objects will be stored. When open up
again, the <b>Addressbook</b> container will be available
under the
root container, with the previously created objects inside it. These
objects are now also available through other programs created with
the compilers or the assembler. This shows how easy is to make an
object persistent: just making a persistent object point to it with
one of its attributes does the job. From the point of view, there is
nothing as simple as this, not needing to worry about any
saving/restore mechanism.</font></p>

<p style="text-indent: 0cm;"><font size="2">
If a user interface is
provided (which can be built with this programming environment or by
any other of the available means), then the <b>addressbook</b>
application will also be available for execution just by using the
command-line VM.</font></p>

</body>
</html>
